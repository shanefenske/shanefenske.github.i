<html>
  <head>
  <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
  <script type="text/javascript" src="data.js"></script>
  <style>
    body {
      margin: 0px;
      padding: 0px;
      font: 12px Arial;
    }
  </style>
  </head>
  <body>
    <button>svg to png</button>
    <canvas id="canvas"></canvas>
    <script type="text/javascript">
    //height of each row in the heatmap
    var h = 50;
    //width of each column in the heatmap
    var w = 100;

    //attach a SVG node to the document
    //height and width defined by the row/column lengths
    var svg = d3.select("body")
      .append("svg")
      .attr("id","svg")
      .attr("width", (w * cols.length) + 400) 
      .attr("height", (h * rows.length + 100))
      .style('position','absolute')
      .style('top',0)
      .style('left',0);

    //define a color scale using the min and max expression values
    var colorScale = d3.scale.linear()
      .domain([minData, 0, maxData])
      .range(["#002db3", "white", "#cc0000"]);

    //generate the heatmap
    var heatmapRow = svg.selectAll(".heatmap")
      .data(data)
      .enter().append("g");

    var heatmapRects = heatmapRow
        .selectAll(".rect")
        .data(function(d) {
          return d;
        }).enter().append("svg:rect")
        .attr('width',w)
        .attr('height',h)
        .attr('dat', function(d) {
          return d[0];
        })
        .attr('x', function(d) {
          return (d[2] * w) + 120;
        })
        .attr('y', function(d) {
          return (d[1] * h) + 70;
        })
        .style('fill',function(d) {
          return colorScale(d[0]);
        });

    //label columns
    var columnLabel = svg.selectAll(".colLabel")
      .data(cols)
      .enter().append('svg:text')
      .attr('x', function(d,i) {
        return ((i + 0.5) * w) + 125;
      })
      .attr('y', 55)
      .attr('class','label')
      .style('text-anchor','middle')
      .text(function(d) {return d;});

    //label columns
    var rowLabel = svg.selectAll(".rowLabel")
      .data(rows)
      .enter().append('svg:text')
      .attr('x', function(d,i) {
        return 75;
      })
      .attr('y', function(d,i) {
        return ((i + 0.5) * h) + 75;
      })
      .attr('class','label')
      .style('text-anchor','middle')
      .text(function(d) {return d;});



svg.append("text")
        .attr("x", ((w * cols.length +250) /2  ))             
        .attr("y", 30 )
        .attr("text-anchor", "middle")  
        .style("font-size", "16px") 
        .style("text-style", "bold")  
        .text("Screener");


svg.append("text")
        .attr("x", 0)            
        .attr("y", 0)
        .attr("text-anchor", "middle")  
        .style("font-size", "16px") 
        .style("text-style", "bold")  
        .text("Ball Handler")
        .attr("transform", "translate(25,250) rotate("+-90+")");

//             .attr("transform", "rotate(-65)" );
        //expression value label
        var expLab = d3.select("body")
          .append('div')
          .style('height',23)
          .style('position','absolute')
          .style('background','FFE53B')
          .style('opacity',0.8)
          .style('top',0)
          .style('padding',10)
          .style('left',40)
          .style('display','none');

    //heatmap mouse events
    heatmapRects
      .on('mouseover', function(d,i) {
        d3.select(this)
        
          .attr('stroke-width',1)
          .attr('stroke','black')

      })
      .on('mouseout', function(d,i) {
        d3.select(this)
          .attr('stroke-width',0)
          .attr('stroke','none')

        expLab
          .style('display','none')
      });


var btn = document.querySelector('button');
var svg = document.querySelector('svg');
var canvas = document.querySelector('canvas');

function triggerDownload (imgURI) {
  var evt = new MouseEvent('click', {
    view: window,
    bubbles: false,
    cancelable: true
  });

  var a = document.createElement('a');
  a.setAttribute('download', 'MY_COOL_IMAGE.png');
  a.setAttribute('href', imgURI);
  a.setAttribute('target', '_blank');

  a.dispatchEvent(evt);
}

btn.addEventListener('click', function () {
  var canvas = document.getElementById('canvas');
  var ctx = canvas.getContext('2d');
  var data = (new XMLSerializer()).serializeToString(svg);
  var DOMURL = window.URL || window.webkitURL || window;

  var img = new Image();
  var svgBlob = new Blob([data], {type: 'image/svg+xml;charset=utf-8'});
  var url = DOMURL.createObjectURL(svgBlob);

  img.onload = function () {
    ctx.drawImage(img, 0, 0);
    DOMURL.revokeObjectURL(url);

    var imgURI = canvas
        .toDataURL('image/png')
        .replace('image/png', 'image/octet-stream');

    triggerDownload(imgURI);
  };

  img.src = url;
});

   </script>

  </body>
</html>