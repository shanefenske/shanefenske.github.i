<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>NBA Data Visualizations with d3.js</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="data.js"></script>
    <link rel="stylesheet" href="css/styles.css" />

</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <a class="navbar-brand" style="color:white">NBA-Viz</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div >
                <ul class="nav navbar-nav">
                    <li>
                        <a  href="/">Shot Carts</a>
                    </li>
                    <li>
                        <a style="color:white" href="screens.html">Screens</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <div class="container">
    <div class="panel panel-default ol-md-12 col-lg-4">
        <div class="panel-body">
            <p>This is a demo of an idea I had while at STATS LLC. to visualize SportVU screen data. I am unsure if it ended up being implemented on the ICE website. Each column is a screener and each row is a ball handler. The rectangles where columns and rows intersect are colored based on the number of points per possession on plays which involved a ball screen that was executed by the corresponding ball handler and screener. The more red the rectangle, the more points that screen combo has generated--the more blue, the less points.</p>
            <p> These charts can also be made for defensive screen combos with the columns becoming screener defenders and the rows becoming ball handler defenders. I think they would be great to include in pregame reports to the coaching staff, as at a glance a coach could see which offensvie combos are working best for his team or which of the opponent's defensive combos should be attacked. Statistics on each
            combo could be added to the center of each rectangle.
            </p>
            <p>
            The data used in this demo is completely made up.
            </p>
        </div>
    </div>
<!--         <div  class="col-md-12 col-lg-4" style="background-color: blue; ">
            <p>
                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, ratione. Veniam doloribus nisi, cum amet, facilis incidunt quos, vitae quasi alias esse voluptate minus labore fugiat explicabo consequatur. Tenetur, voluptatibus?
                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Atque quos aspernatur, enim perferendis. Dolorum veniam ullam quod voluptatibus, voluptates enim, ipsum reiciendis, distinctio fugit laborum consequatur atque perspiciatis illo quas.
                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aut esse eaque numquam optio laudantium, accusantium fugit et quo voluptatem reprehenderit quas eos deserunt, perferendis, beatae. Fuga nemo, repellendus ad error.
            </p>        
        </div> -->
        <div  id="heatcontainer" class="col-md-12 col-lg-8">
            <div  class="col-lg-12">
                <select >
                    <option selected>Brooklyn Nets</option>             
                </select>
                <select >
                    <option selected>Offensive</option>  
                    <option value="">Defensive</option>         
                </select>
                <button>Generate</button>  
                <a style="color:#337ab7" id='imgId'>Export to PNG</a>
            </div>
        </div>
       
        
        
    <!-- /.row -->

</div>
<!-- /.container -->


<script>
// sketchy way to make sure nav bar is right size on small screens
    $( document ).ready(function() {
      $(".navbar").css({
        'width': ($('#heatmap').width() > $('body').width() ? $('#heatmap').width() : $('body').width()) + 'px'
    });
  });

    $( window ).resize(function() {  
      $(".navbar").css({
        'width': ($('#heatmap').width() > $('body').width() ? $('#heatmap').width() : $('body').width()) + 'px'
    });
  });
</script>

<script>
    $( "button" ).click(function() {
      alert( "This is just a demo. No other charts are available." );
    });       
</script>
<script type="text/javascript">
//height of each row in the heatmap
var h = 50;
//width of each column in the heatmap
var w = 100;

var width = (w * cols.length) + 200;

var height = h * rows.length + 100;

//attach a SVG node to the document
//height and width defined by the row/column lengths
var svg = d3.select("#heatcontainer")
    .append("svg") 
    .attr("id","heatmap")
    .attr("xmlns","http://www.w3.org/2000/svg")
    .attr("width",  width)
    .attr("height", height)
    // .style('position','absolute')
    .style('top',0)
    .style('left',0);

//define a color scale using the min and max expression values
var colorScale = d3.scale.linear()
    .domain([minData, 1, maxData])
    .range(["#002db3", "rgb(228,232,246)", "#cc0000"]);

//generate the heatmap
var heatmapRow = svg.selectAll(".heatmap")
    .data(data)
    .enter().append("g");

var heatmapRects = heatmapRow
    .selectAll(".rect")
    .data(function(d) {
        return d;
    }).enter().append("svg:rect")
    .attr('width',w)
    .attr('height',h)
    .attr('dat', function(d) {
        return d[0];
    })
    .attr('x', function(d) {
        return (d[2] * w) + 120;
    })
    .attr('y', function(d) {
        return (d[1] * h) + 70;
    })
    .style('fill',function(d) {
        return colorScale(d[0]);
    });

//label columns
var columnLabel = svg.selectAll(".colLabel")
    .data(cols)
    .enter().append('svg:text')
    .attr('x', function(d,i) {
        return ((i + 0.5) * w) + 125;
    })
    .attr('y', 55)
    .attr('class','label')
    .style('text-anchor','middle')
    .text(function(d) {return d;});

//label columns
var rowLabel = svg.selectAll(".rowLabel")
    .data(rows)
    .enter().append('svg:text')
    .attr('x', function(d,i) {
        return 75;
    })
    .attr('y', function(d,i) {
        return ((i + 0.5) * h) + 75;
    })
    .attr('class','label')
    .style('text-anchor','middle')
    .text(function(d) {return d;});

svg.append("text")
    .attr("x", ((width +50) / 2 ))             
    .attr("y", 30 )
    .attr("text-anchor", "middle")  
    .style("font-size", "16px") 
    .style("text-style", "bold")  
    .text("Screener");

svg.append("text")
    .attr("x", 0)            
    .attr("y", 0)
    .attr("text-anchor", "middle")  
    .style("font-size", "16px") 
    .style("text-style", "bold")  
    .text("Ball Handler")
    .attr("transform", "translate(15,250) rotate("+-90+")");


//expression value label
var expLab = d3.select("body")
.append('div')
.style('height',23)
.style('position','absolute')
.style('background','FFE53B')
.style('opacity',0.8)
.style('top',0)
.style('padding',10)
.style('left',40)
.style('display','none');

//heatmap mouse events
heatmapRects
    .on('mouseover', function(d,i) {
    $(".defaulttooltip").css('display','none');
    d3.select(this)        
    .attr('stroke-width',1)
    .attr('stroke','black')

// add the tooltip area to the webpage
var tooltip = d3.select("#heatcontainer").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

tooltip.transition()
    .duration(200)
    .style("opacity", .9);

tooltip.html(d[0] + " PPP on " + d[3] + " possessions that included this screen combo.")
    .style("left", 420 + "px")     
    .style("top", 5 +"px");
})
.on('mouseout', function(d,i) {
    $(".tooltip").remove();
    $(".defaulttooltip").css('display','inline')
    d3.select(this)
        .attr('stroke-width',0)
        .attr('stroke','none')

    expLab.style('display','none')
});

var defaulttooltip = d3.select("#heatcontainer").append("text")
    .attr("class", "defaulttooltip")
    .style("left", 420 + "px")     
    .style("top", 1 +"px")
    .style("position", "absolute")    
    .text("Hover on map for screen statistics");


var heatMap = document.getElementById('heatmap');
var svg_xml = (new XMLSerializer()).serializeToString(heatMap),
blob = new Blob([svg_xml], {type:'image/svg+xml;charset=utf-8'}),
url = window.URL.createObjectURL(blob);

var img = new Image();
img.width = width;
img.height = height;
img.onload = function(){
var canvas = document.createElement('canvas');
canvas.width = width;
canvas.height = height;

var ctx = canvas.getContext('2d');
ctx.drawImage(img, 0, 0, width, height);

window.URL.revokeObjectURL(url);
var canvasdata = canvas.toDataURL('image/png');
var a = document.getElementById('imgId');
a.download = "nets_offensive_ballscreen_heatmap.png";
a.href=canvasdata;   
}
img.src = url  
</script>

<footer class="container-fluid">
    <p class="text-right small">Created by: Shane Fenske</p>
</footer>

</body>

</html>
