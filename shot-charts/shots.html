<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>NBA Data Visualizations with d3.js</title>

    <!-- Bootstrap Core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <!-- jQuery Version 1.11.1 -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
  
  <script type="text/javascript" src="data.js"></script>

    <!-- Custom CSS -->
    <style>
    body {
        padding-top: 70px;
        /* Required padding for .navbar-fixed-top. Remove if using .navbar-static-top. Change if height of navigation changes. */
    }
    </style>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">

                <a class="navbar-brand" style="color:white">NBA-Viz</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div >
                <ul class="nav navbar-nav">
                    <li>
                        <a style="color:white" href="shots.html">Shot Carts</a>
                    </li>
                    <li>
                        <a  href="screens.html">Screens</a>
                    </li>
                </ul>
            </div>



            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <div class="container">

        <div  class="row">
            <div  class="col-lg-12">
 <select >
    <option selected>Brooklyn Nets</option>             
</select>
  <a id='imgId'>Export to PNG</a>
    <script type="text/javascript">
    //height of each row in the heatmap
    var h = 50;
    //width of each column in the heatmap
    var w = 100;

    var width = (w * cols.length) + 400;

    var height = h * rows.length + 100;

    //attach a SVG node to the document
    //height and width defined by the row/column lengths
    var svg = d3.select("body")
      .append("svg") 
      .attr("id","heatmap")
      .attr("xmlns","http://www.w3.org/2000/svg")
      .attr("width",  width)
      .attr("height", height)
      // .style('position','absolute')
      .style('top',0)
      .style('left',0);

    //define a color scale using the min and max expression values
    var colorScale = d3.scale.linear()
      .domain([minData, 0, maxData])
      .range(["#002db3", "white", "#cc0000"]);

    //generate the heatmap
    var heatmapRow = svg.selectAll(".heatmap")
      .data(data)
      .enter().append("g");

    var heatmapRects = heatmapRow
        .selectAll(".rect")
        .data(function(d) {
          return d;
        }).enter().append("svg:rect")
        .attr('width',w)
        .attr('height',h)
        .attr('dat', function(d) {
          return d[0];
        })
        .attr('x', function(d) {
          return (d[2] * w) + 120;
        })
        .attr('y', function(d) {
          return (d[1] * h) + 70;
        })
        .style('fill',function(d) {
          return colorScale(d[0]);
        });


    //label columns
    var columnLabel = svg.selectAll(".colLabel")
      .data(cols)
      .enter().append('svg:text')
      .attr('x', function(d,i) {
        return ((i + 0.5) * w) + 125;
      })
      .attr('y', 55)
      .attr('class','label')
      .style('text-anchor','middle')
      .text(function(d) {return d;});

    //label columns
    var rowLabel = svg.selectAll(".rowLabel")
      .data(rows)
      .enter().append('svg:text')
      .attr('x', function(d,i) {
        return 75;
      })
      .attr('y', function(d,i) {
        return ((i + 0.5) * h) + 75;
      })
      .attr('class','label')
      .style('text-anchor','middle')
      .text(function(d) {return d;});



svg.append("text")
        .attr("x", ((width - 150) / 2 ))             
        .attr("y", 30 )
        .attr("text-anchor", "middle")  
        .style("font-size", "16px") 
        .style("text-style", "bold")  
        .text("Screener");


svg.append("text")
        .attr("x", 0)            
        .attr("y", 0)
        .attr("text-anchor", "middle")  
        .style("font-size", "16px") 
        .style("text-style", "bold")  
        .text("Ball Handler")
        .attr("transform", "translate(15,250) rotate("+-90+")");

//             .attr("transform", "rotate(-65)" );
        //expression value label
        var expLab = d3.select("body")
          .append('div')
          .style('height',23)
          .style('position','absolute')
          .style('background','FFE53B')
          .style('opacity',0.8)
          .style('top',0)
          .style('padding',10)
          .style('left',40)
          .style('display','none');

    //heatmap mouse events
    heatmapRects
      .on('mouseover', function(d,i) {
        d3.select(this)        
          .attr('stroke-width',1)
          .attr('stroke','black')

        // add the tooltip area to the webpage
        var tooltip = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

            tooltip.transition()
            .duration(200)
            .style("opacity", .9);

            tooltip.html(d[0])
            .style("left", (d3.event.pageX + 5) + "px")
            .style("top", (d3.event.pageY - 28) + "px");
        })
      .on('mouseout', function(d,i) {
        $(".tooltip").remove();
        d3.select(this)
          .attr('stroke-width',0)
          .attr('stroke','none')
          
        expLab
          .style('display','none')
      });


var heatMap = document.getElementById('heatmap');
var svg_xml = (new XMLSerializer()).serializeToString(heatMap),
    blob = new Blob([svg_xml], {type:'image/svg+xml;charset=utf-8'}),
    url = window.URL.createObjectURL(blob);

var img = new Image();
img.width = width;
img.height = height;
img.onload = function(){
    var canvas = document.createElement('canvas');
    canvas.width = width;
    canvas.height = height;

    var ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0, width, height);

    window.URL.revokeObjectURL(url);
    var canvasdata = canvas.toDataURL('image/png');
    var a = document.getElementById('imgId');
    a.download = "export_" + Date.now() + ".png";
    a.href=canvasdata;   
}
img.src = url  
</script>
            </div>
        </div>
        <!-- /.row -->

    </div>
    <!-- /.container -->

    

</body>

</html>
